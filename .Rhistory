mutate(Peru_cases_increase  = ifelse(is.na(Peru_cases_increase ), 0, Peru_cases_increase )) %>%
mutate(Date=format(Date, "%Y-%m-%d")) %>%
select(Date, Peru_cases_increase) %>%
uncount(Peru_cases_increase)
Peru_incidence_object <- incidence(Peru_incidence_function_data$Date)
Peru_incidence_peak <- find_peak(Peru_incidence_object)
plot(Peru_incidence_object) +
geom_vline(xintercept = Peru_incidence_peak, col = "red", lty = 2) +
labs(title="Daily number of lab-confirmed possitive cases in Peru",
subtitle = "(red line indicates date of peak incidence)") +
theme_bw()
# Due that the model doesn't show an statistical peak just yet
Peru_incidence_fit <- incidence::fit(Peru_incidence_object)
# plot the incidence data and the model fit
plot(Peru_incidence_object) %>%
add_incidence_fit(Peru_incidence_fit) +
labs(title="Daily number of lab-confirmed possitive cases in Peru",
subtitle = "Observed VS Modeled") +
theme_bw()
growth_model_fit_stats <- glance(Peru_incidence_fit$model) %>%
mutate(Dates="all") %>%
select(Dates, r.squared, adj.r.squared, deviance)
growth_model_fit_stats %>%
gt(rowname_col = "Date") %>%
fmt_number(columns=2:4, decimals = 2) %>%
cols_label(
r.squared = html("R<sup>2</sup>"),
adj.r.squared = html("Adj. R<sup>2</sup>"),
deviance = "Deviance"
)
# plot the incidence data and the model fit
plot(Peru_incidence_object) %>%
add_incidence_fit(Peru_incidence_fit) +
labs(title="Daily number of lab-confirmed possitive cases in Peru",
subtitle = "Observed VS Modeled") +
theme_bw()
Peru_plot_lambda <- function(res) {
plot(res, "lambdas", scale = length(res$local_case_dates) + 1,
bty="n")
title(sub=paste("\nEstimated", expression(lambda), "for",
res$prefecture,
"(assuming serial interval mean =",
res$si_mean,
", sd =",
res$si_sd, ")"))
abline(v = res$local_case_dates, lwd = 3, col = "grey")
abline(v = res$last_date, col = "blue", lty = 2, lwd = 2)
points(res$local_case_dates, seq_along(res$local_case_dates), pch = 20, cex = 3)
}
COVID_19_Peru_Raw
prefectural_earlyR <- function(df, last_date, si_mean, si_sd) {
df %>%
filter(Date <= last_date,
!is.na(incident_cases)) %>%
select(Date, incident_cases) %>%
uncount(incident_cases) %>%
pull(Date) -> local_case_dates
local_case_dates %>%
incidence(., last_date=last_date) -> local_cases
res <- get_R(local_cases, si_mean =si_mean, si_sd = si_sd)
res$local_case_dates <- local_case_dates
res$prefecture <- prefecture
res$last_date <- last_date
res$si_mean <- si_mean
res$si_sd <- si_sd
return(res)
}
prefecture_plot_lambda <- function(res) {
plot(res, "lambdas", scale = length(res$local_case_dates) + 1,
bty="n")
title(sub=paste("\nEstimated", expression(lambda), "for",
"(assuming serial interval mean =",
res$si_mean,
", sd =",
res$si_sd, ")"))
abline(v = res$local_case_dates, lwd = 3, col = "grey")
abline(v = res$last_date, col = "blue", lty = 2, lwd = 2)
points(res$local_case_dates, seq_along(res$local_case_dates), pch = 20, cex = 3)
}
lambda_plot_j <- function(pref) {
res_obj <- prefectural_earlyR(japanese_prefectures_confirmed,
last_date_j,
si_mean,
si_sd)
prefecture_plot_lambda(res_obj)
}
lambda_plot_j(pref)
lambda_plot_j()
COVID_19_Peru_Raw %>%
filter(Date <= last_date,
!is.na(incident_cases))
last_date <- ymd(Sys.Date())
last_date
COVID_19_Peru_Raw %>%
filter(Date <= last_date,
!is.na(incident_cases))
Peru_Cumulative_Incidence
Peru_Cumulative_Incidence %>%
filter(Date <= last_date,
!is.na(Peru_cases_increase))
Peru_Cumulative_Incidence %>%
filter(Date <= last_date,
!is.na(Peru_cases_increase))
Peru_Cumulative_Incidence %>%
filter(Date <= last_date,
!is.na(incident_cases))
Peru_Cumulative_Incidence %>%
filter(Date <= last_date,
!is.na(incident_cases)) %>%
select(Date, incident_cases)
Peru_Cumulative_Incidence %>%
filter(Date <= last_date,
!is.na(incident_cases)) %>%
select(Date, incident_cases) %>%
uncount(incident_cases)
Peru_Cumulative_Incidence %>%
filter(Date <= last_date,
!is.na(incident_cases)) %>%
select(Date, incident_cases) %>%
uncount(incident_cases) %>%
pull(Date) -> local_case_dates
Peru_Cumulative_Incidence %>%
filter(Date <= last_date,
!is.na(incident_cases)) %>%
select(Date, incident_cases) %>%
uncount(incident_cases) %>%
pull(Date) -> local_case_dates
local_case_dates
Peru_Cumulative_Incidence
pref="Peru_cases_increase"
last_date <- ymd(Sys.Date())
Peru_Cumulative_Incidence %>%
filter(Date <= last_date,
!is.na(incident_cases),
province == pref)
Peru_Cumulative_Incidence %>%
filter(Date <= last_date,
!is.na(incident_cases),
province == pref) %>%
select(Date, incident_cases)
Peru_Cumulative_Incidence %>%
filter(Date <= last_date,
!is.na(incident_cases),
province == pref) %>%
select(Date, incident_cases) %>%
uncount(incident_cases)
Peru_Cumulative_Incidence %>%
filter(Date <= last_date,
!is.na(incident_cases),
province == pref) %>%
select(Date, incident_cases) %>%
uncount(incident_cases) %>%
pull(Date) -> local_case_dates
local_case_dates %>%
incidence(., last_date=last_date) -> local_cases
Peru_Cumulative_Incidence %>%
filter(Date <= last_date,
!is.na(incident_cases),
province == pref) %>%
select(Date, incident_cases) %>%
uncount(incident_cases) %>%
pull(Date) -> local_case_dates
local_case_dates %>%
incidence(., last_date=last_date) -> local_cases
res <- get_R(local_cases, si_mean =si_mean, si_sd = si_sd)
res$local_case_dates <- local_case_dates
res$prefecture <- prefecture
res$last_date <- last_date
res$si_mean <- si_mean
res$si_sd <- si_sd
return(res)
Peru_Cumulative_Incidence %>%
filter(Date <= last_date,
!is.na(incident_cases),
province == pref) %>%
select(Date, incident_cases) %>%
uncount(incident_cases) %>%
pull(Date) -> local_case_dates
local_case_dates %>%
incidence(., last_date=last_date) -> local_cases
res <- get_R(local_cases, si_mean =si_mean, si_sd = si_sd)
res$local_case_dates <- local_case_dates
local_cases
get_R(local_cases, si_mean =si_mean, si_sd = si_sd)
si_mean <- 5.0
si_sd <- 3.4
alt_si_mean <- 7.5
alt_si_sd <- 3.4
pref="Peru_cases_increase"
last_date <- ymd(Sys.Date())
prefectural_earlyR <- function(df, prefecture, last_date, si_mean, si_sd) {
Peru_Cumulative_Incidence %>%
filter(Date <= last_date,
!is.na(incident_cases),
province == prefecture) %>%
select(Date, incident_cases) %>%
uncount(incident_cases) %>%
pull(Date) -> local_case_dates
local_case_dates %>%
incidence(., last_date=last_date) -> local_cases
res <- get_R(local_cases, si_mean =si_mean, si_sd = si_sd)
res$local_case_dates <- local_case_dates
res$prefecture <- prefecture
res$last_date <- last_date
res$si_mean <- si_mean
res$si_sd <- si_sd
return(res)
}
prefecture_plot_lambda <- function(res) {
plot(res, "lambdas", scale = length(res$local_case_dates) + 1,
bty="n")
title(sub=paste("\nEstimated", expression(lambda), "for",
res$prefecture,
"(assuming serial interval mean =",
res$si_mean,
", sd =",
res$si_sd, ")"))
abline(v = res$local_case_dates, lwd = 3, col = "grey")
abline(v = res$last_date, col = "blue", lty = 2, lwd = 2)
points(res$local_case_dates, seq_along(res$local_case_dates), pch = 20, cex = 3)
}
lambda_plot_j <- function(pref) {
res_obj <- prefectural_earlyR(japanese_prefectures_confirmed,
pref,
last_date_j,
si_mean,
si_sd)
prefecture_plot_lambda(res_obj)
}
lambda_plot_j(pref)
lambda_plot_j <- function(pref) {
res_obj <- prefectural_earlyR(japanese_prefectures_confirmed,
pref,
last_date,
si_mean,
si_sd)
prefecture_plot_lambda(res_obj)
}
lambda_plot_j(pref)
# plot the incidence data and the model fit
plot(Peru_incidence_object) %>%
add_incidence_fit(Peru_incidence_fit) +
labs(title="Daily number of lab-confirmed possitive cases in Peru",
subtitle = "Observed VS Modeled") +
theme_bw()
mu <- 7.5 # days
growth_model_fit_stats <- glance(Peru_incidence_fit$model) %>%
mutate(Dates="all") %>%
select(Dates, r.squared, adj.r.squared, deviance)
growth_model_fit_stats %>%
gt(rowname_col = "Date") %>%
fmt_number(columns=2:4, decimals = 2) %>%
cols_label(
r.squared = html("R<sup>2</sup>"),
adj.r.squared = html("Adj. R<sup>2</sup>"),
deviance = "Deviance"
)
mu <- 7.5 # days
sigma <- 3.4 # days
param <- gamma_mucv2shapescale(mu, sigma / mu)
w <- distcrete("gamma", interval = 1,
shape = param$shape,
scale = param$scale, w = 0)
growth_R0 <- lm2R0_sample(Peru_incidence_fit$model, w)
hist(growth_R0, col = "darkblue", border = "white", main = "R0 distribution in Peru")
summary(growth_R0)
provincia <- "Peru_cases_increase"
last_date <- ymd(Sys.Date())
prefectural_earlyR <- function(df, provincia, last_date, si_mean, si_sd) {
Peru_Cumulative_Incidence %>%
filter(Date <= last_date,
!is.na(incident_cases),
province == provincia) %>%
select(Date, incident_cases) %>%
uncount(incident_cases) %>%
pull(Date) -> local_case_dates
local_case_dates %>%
incidence(., last_date=last_date) -> local_cases
res <- get_R(local_cases, si_mean =si_mean, si_sd = si_sd)
res$local_case_dates <- local_case_dates
res$provincia <- provincia
res$last_date <- last_date
res$si_mean <- si_mean
res$si_sd <- si_sd
return(res)
}
prefecture_plot_lambda <- function(res) {
plot(res, "lambdas", scale = length(res$local_case_dates) + 1,
bty="n")
title(sub=paste("\nEstimated", expression(lambda), "for",
res$provincia,
"(assuming serial interval mean =",
res$si_mean,
", sd =",
res$si_sd, ")"))
abline(v = res$local_case_dates, lwd = 3, col = "grey")
abline(v = res$last_date, col = "blue", lty = 2, lwd = 2)
points(res$local_case_dates, seq_along(res$local_case_dates), pch = 20, cex = 3)
}
lambda_plot_j <- function(provincia) {
res_obj <- prefectural_earlyR(japanese_prefectures_confirmed,
provincia,
last_date,
si_mean,
si_sd)
prefecture_plot_lambda(res_obj)
}
lambda_plot_j(provincia)
t_start <- seq(5, length(Peru_confirmed_cases$local)-1)
Peru_confirmed_cases
growth_model_fit_stats <- glance(Peru_incidence_fit$model) %>%
mutate(Dates="all") %>%
select(Dates, r.squared, adj.r.squared, deviance)
growth_model_fit_stats %>%
gt(rowname_col = "Date") %>%
fmt_number(columns=2:4, decimals = 2) %>%
cols_label(
r.squared = html("R<sup>2</sup>"),
adj.r.squared = html("Adj. R<sup>2</sup>"),
deviance = "Deviance"
)
growth_model_fit_stats %>%
gt(rowname_col = "Date") %>%
fmt_number(columns=2:4, decimals = 2) %>%
cols_label(
r.squared = xml2::read_html("R<sup>2</sup>"),
adj.r.squared = xml2::read_html("Adj. R<sup>2</sup>"),
deviance = "Deviance"
)
growth_model_fit_stats
growth_model_fit_stats %>%
gt(rowname_col = "Date") %>%
fmt_number(columns=2:4, decimals = 2) %>%
cols_label(
r.squared = html("R<sup>2</sup>"),
adj.r.squared = html("Adj. R<sup>2</sup>"),
deviance = "Deviance"
)
end_date <- Sys.Date()
end_date
start_date <- "2020-03-06"
end_date <- Sys.Date()
growth_model_fit_stats %>%
gt() %>%
tab_header(
title = "S&P 500",
subtitle = glue::glue("{start_date} to {end_date}")
)
growth_model_fit_stats %>%
gt() %>%
tab_header(
title = "S&P 500",
subtitle = glue::glue("{start_date} to {end_date}")
) %>%
fmt_number(columns=2:4, decimals = 2) %>%
cols_label(
r.squared = html("R<sup>2</sup>"),
adj.r.squared = html("Adj. R<sup>2</sup>"),
deviance = "Deviance"
)
growth_model_fit_stats %>%
gt() %>%
tab_header(
title = "S&P 500",
subtitle = glue::glue("{start_date} to {end_date}")
) %>%
fmt_number(columns=2:4, decimals = 2) %>%
cols_label(
r.squared = html("R2"),
adj.r.squared = html("Adj. R2"),
deviance = "Deviance"
)
growth_model_fit_stats
growth_model_fit_stats %>%
gt() %>%
tab_header(title = "S&P 500",
subtitle = glue::glue("{start_date} to {end_date}")) %>%
fmt_number(columns=2:4, decimals = 2) %>%
cols_label(r.squared = html("R2"),
adj.r.squared = html("Adj. R2"),
deviance = "Deviance" )
growth_model_fit_stats %>%
gt() %>%
tab_header(title = "S&P 500",
subtitle = glue::glue("{start_date} to {end_date}")) %>%
fmt_number(columns=2:4, decimals = 2) %>%
cols_label(r.squared = html("R<sup>2</sup>"),
adj.r.squared = html("Adj. R2"),
deviance = "Deviance" )
growth_model_fit_stats %>%
gt() %>%
tab_header(title = "S&P 500",
subtitle = glue::glue("{start_date} to {end_date}")) %>%
fmt_number(columns=2:4, decimals = 2) %>%
cols_label(r.squared = xml2::read_html("R<sup>2</sup>"),
adj.r.squared = xml2::read_html("Adj. R2"),
deviance = "Deviance" )
growth_model_fit_stats %>%
gt() %>%
tab_header(title = "S&P 500",
subtitle = glue::glue("{start_date} to {end_date}")) %>%
fmt_number(columns=2:4, decimals = 2) %>%
cols_label(r.squared = xml2::read_html("R<sup>2</sup>"),
adj.r.squared = xml2::read_html("Adj. R<sup>2</sup>"),
deviance = "Deviance" )
?cols_label
growth_model_fit_stats %>%
gt() %>%
tab_header(title = "S&P 500",
subtitle = glue::glue("{start_date} to {end_date}")) %>%
fmt_number(columns=2:4, decimals = 2) %>%
cols_label(r.squared = md("**R2**"),
adj.r.squared = md("**Adj. R2**"),
deviance = "Deviance" )
growth_model_fit_stats %>%
gt() %>%
tab_header(title = "S&P 500",
subtitle = glue::glue("{start_date} to {end_date}")) %>%
fmt_number(columns=2:4, decimals = 2) %>%
cols_label(Dates = md(**Dates**),
r.squared = md("**R2**"),
adj.r.squared = md("**Adj. R2**"),
deviance = md("**Deviance**") )
growth_model_fit_stats %>%
gt() %>%
tab_header(title = "S&P 500",
subtitle = glue::glue("{start_date} to {end_date}")) %>%
fmt_number(columns=2:4, decimals = 2) %>%
cols_label(Dates = md("**Dates**"),
r.squared = md("**R2**"),
adj.r.squared = md("**Adj. R2**"),
deviance = md("**Deviance**") )
growth_model_fit_stats %>%
gt() %>%
tab_header(title = "Model Fitted Statistics",
subtitle = glue::glue("{start_date} to {end_date}")) %>%
fmt_number(columns=2:4, decimals = 2) %>%
cols_label(Dates = md("**Dates**"),
r.squared = md("**R2**"),
adj.r.squared = md("**Adj. R2**"),
deviance = md("**Deviance**") )
growth_model_fit_stats %>%
gt() %>%
tab_header(title = "Model Fitted Statistics",
subtitle = "Up to Date")) %>%
fmt_number(columns=2:4, decimals = 2) %>%
cols_label(Dates = md("**Dates**"),
r.squared = md("**R2**"),
adj.r.squared = md("**Adj. R2**"),
deviance = md("**Deviance**") )
growth_model_fit_stats %>%
gt() %>%
tab_header(title = "Model Fitted Statistics",
subtitle = "Up to Date") %>%
fmt_number(columns=2:4, decimals = 2) %>%
cols_label(Dates = md("**Dates**"),
r.squared = md("**R2**"),
adj.r.squared = md("**Adj. R2**"),
deviance = md("**Deviance**") )
growth_model_fit_stats %>%
gt() %>%
tab_header(title = "Model Fitted Statistics",
subtitle = glue::glue("Last update on: {end_date}")) %>%
fmt_number(columns=2:4, decimals = 2) %>%
cols_label(Dates = md("**Dates**"),
r.squared = md("**R2**"),
adj.r.squared = md("**Adj. R2**"),
deviance = md("**Deviance**") )
growth_model_fit_stats %>%
gt() %>%
tab_header(title = md("**Model Fitted Statistics"**),
subtitle = glue::glue("Last update on: {end_date}")) %>%
fmt_number(columns=2:4, decimals = 2) %>%
cols_label(Dates = md("**Dates**"),
r.squared = md("**R2**"),
adj.r.squared = md("**Adj. R2**"),
deviance = md("**Deviance**") )
growth_model_fit_stats %>%
gt() %>%
tab_header(title = md("**Model Fitted Statistics**"),
subtitle = glue::glue("Last update on: {end_date}")) %>%
fmt_number(columns=2:4, decimals = 2) %>%
cols_label(Dates = md("**Dates**"),
r.squared = md("**R2**"),
adj.r.squared = md("**Adj. R2**"),
deviance = md("**Deviance**") )
growth_model_fit_stats <- glance(Peru_incidence_fit$model) %>%
mutate(Dates="all") %>%
select(Dates, r.squared, adj.r.squared, deviance)
end_date <- Sys.Date()
growth_model_fit_stats %>%
gt() %>%
tab_header(title = md("**Model Fitted Statistics**"),
subtitle = glue::glue("Last update on: {end_date}")) %>%
fmt_number(columns=2:4, decimals = 2) %>%
cols_label(Dates = md("**Dates**"),
r.squared = md("**R2**"),
adj.r.squared = md("**Adj. R2**"),
deviance = md("**Deviance**") )
growth_model_fit_stats <- glance(Peru_incidence_fit$model) %>%
mutate(Dates="all") %>%
select(Dates, r.squared, adj.r.squared, deviance)
end_date <- Sys.Date()
growth_model_fit_stats %>%
gt() %>%
tab_header(title = md("**Model Fitted Statistics**"),
subtitle = glue::glue("Last update on: {end_date}")) %>%
fmt_number(columns=2:4, decimals = 2) %>%
cols_label(Dates = md("**Dates**"),
r.squared = md("**R2**"),
adj.r.squared = md("**Adj. R2**"),
deviance = md("**Deviance**") )
